This is a migration task. The system currently works. Your job is to improve the architecture WITHOUT breaking or forgetting any existing behavior.
NON-NEGOTIABLE INVARIANTS
* Existing museum logic must continue to work.
* Existing artifact logic must continue to work.
* Existing RAG behavior must continue to work.
* Existing API routes and UI flows must not break.
* JSON files must remain usable during the transition.
* Nothing gets deleted or rewritten unless explicitly approved. If improving one part risks breaking another, STOP and explain the tradeoff before proceeding. ======================== CURRENT STATE (FACTS) ========================
* Museum and artifact data live in JSON files.
* Each museum has its own JSON file.
* Artifacts are nested inside museum files.
* JSON is currently the source of truth.
* This structure is functional but disorganized and not scalable.
* This structure is inefficient for long-term RAG usage and AI cost control. ======================== TARGET DIRECTION ========================
* Migrate museum and artifact data into a database.
* Treat JSON as seed/import data, not the long-term source of truth.
* Support future scale: many museums, many artifacts, many notes.
* Improve retrieval efficiency for AI (artifact-level, not museum-level). ======================== PHASED EXECUTION PLAN ======================== PHASE 1 — ANALYSIS (NO CODE)
1. Ask me for the exact files you need to inspect.
2. Identify:
   * Where JSON is loaded
   * Where museums are resolved
   * Where artifacts are queried
   * Where RAG context is assembled
3. Explicitly list all places where JSON is currently relied upon.
4. Do NOT propose solutions yet. PHASE 2 — DATA MODEL PROPOSAL
1. Propose a database-based data organization that:
   * Separates museums from artifacts
   * Preserves all existing data relationships
   * Supports curator notes and future metadata
2. Explain how this structure:
   * Improves performance
   * Reduces AI context size
   * Lowers RAG cost
3. Do NOT write code yet. PHASE 3 — MIGRATION STRATEGY
1. Explain how to migrate existing JSON data into the database.
2. Explain how JSON will:
   * Act as seed/import data
   * Remain available during transition
   * Be safely deprecated later
3. Ensure the app can run while BOTH systems exist temporarily. PHASE 4 — APPLICATION INTEGRATION
1. Describe how the app should:
* Read from the database instead of JSON
* Resolve museum → artifact relationships
* Preserve existing API and UI behavior
1. Ensure no feature regression occurs. PHASE 5 — RAG SAFETY CHECK
1. Explain how artifact-level retrieval will work.
2. Confirm that:
* No large documents are sent unnecessarily
* Retrieval remains fast and cheap
* Context size stays minimal ======================== PROCESS RULES ========================
* Do not assume database technology.
* Do not assume schema details unless asked.
* Do not collapse phases.
* Do not write code without approval.
* If any step risks breaking another, flag it immediately. ======================== DELIVERABLE ========================
* A complete, ordered migration plan.
* Each phase must explicitly reference earlier phases.
* Nothing should be forgotten, skipped, or implicitly changed. This task is about controlled migration, not refactoring or feature expansion.

THIS WAS YOUR REPONSE:
PHASE 1 — ANALYSIS (NO CODE)
I need to inspect the exact files to map the current system. Please provide:
Files I Need to See:
1. RAG System Core
* src/lib/rag/retrieval.ts (document 87) - I have this
* src/lib/rag/embeddings.ts (document 93) - I have this
* src/lib/rag/types.ts (document 75) - I have this
* src/lib/rag/index.ts (document 43) - I have this
2. API Routes that Touch Museum/Artifact Data
* src/app/api/artworks/[id]/route.ts (document 17) - I have this
* src/app/api/museums/route.ts (document 89) - I have this
* src/app/api/admin/museum/[id]/artworks/route.ts (document 6) - I have this
* src/app/api/chat/route.ts (document 55) - I have this
3. Current Data Files (to understand structure)
* data/museums/museums.json (document 82) - I have this
* data/museums/met.json (document 84) - I have this
* data/museums/moma.json - NOT in documents
* data/museums/louvre.json (document 83) - I have this
4. Database Schema
* prisma/schema.prisma (document 108) - I have this
Initial Observations (Based on What I Have):
JSON Dependencies Identified:
A. RAG System (src/lib/rag/retrieval.ts)
typescript

// Lines ~40-60: Loads museums.json at startup
const museumsPath = path.join(this.dataPath, 'museums.json');
const museums: Museum[] = JSON.parse(museumsData);

// Lines ~65-95: For each museum, loads individual JSON file
const museumFilePath = path.join(this.dataPath, `${museum.id}.json`);
const museumInfo: MuseumJsonData = JSON.parse(museumData);
B. Museum Resolution
typescript

// Museums stored in Map: this.museums = new Map<string, Museum>()
// Artworks stored with composite key: "museumId:artworkId"
// Example: "met:washington_crossing"
C. Artifact Queries
typescript

// getArtworkData(artworkId, museumId?) - searches composite keys
// getMuseumArtworks(museumId) - filters by museum prefix
// semanticSearch() - searches embeddings created from JSON
D. RAG Context Assembly
typescript

// chunkArtwork() creates embeddings from JSON data
// Includes: description, provenance, technical details, curator notes
// All loaded at server startup, stored in memory
Questions Before Proceeding to Analysis:
1. Do you have data/museums/moma.json? (I only see reference to it, not content)
2. Curator Notes Current State:
   * I see curator notes API (src/app/api/curator/notes/route.ts - document 99/renamed)
   * I see database table curator_notes in Prisma schema
   * Question: Are there ANY curator notes currently stored in the JSON files? Or are they only in the database?
3. Artwork Table in Database:
   * I see an Artwork model in Prisma (document 108)
   * Question: Is this table currently being used? Or is it legacy/unused?
   * The JSON files seem to be the only source of artwork data currently
4. Missing File Check:
   * Is there a data/museums/moma.json file I should see?
   * Are there any other JSON files in data/museums/ besides met, moma, louvre, sample-museum?
Initial Risk Assessment:
⚠️ CRITICAL DEPENDENCIES ON JSON:
* RAG system loads once at startup
* All embeddings created from JSON
* No hot-reload when JSON changes
* Curator notes in DB are NOT in JSON → NOT embedded → NOT searchable by AI
⚠️ DUAL STORAGE PROBLEM:
* Artworks: JSON only (source of truth)
* Curator Notes: Database only (NOT in JSON, NOT in RAG)
* This is why curator notes don't work with AI currently
WAITING FOR YOUR RESPONSE BEFORE PROCEEDING TO FULL ANALYSIS
Please confirm:
1. Any missing JSON files I should see
2. Status of the Prisma Artwork table (used/unused?)
3. Whether curator notes exist in JSON anywhere
Then I'll complete Phase 1 with a comprehensive dependency map.
Claude is AI and can make mistakes. Please double-check responses.